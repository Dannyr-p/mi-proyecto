<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Banco de Preguntas</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f8f9fa;
      padding: 20px;
    }
    .contenedor {
      max-width: 800px;
      margin: auto;
    }
    .modo-selector, .filtro {
      margin-bottom: 20px;
    }
    .pregunta-card {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 20px;
      margin-bottom: 20px;
    }
    h2 {
      margin-top: 0;
    }
    .opciones button {
      display: block;
      margin: 10px 0;
      padding: 10px;
      width: 100%;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .opciones button:hover {
      background-color: #0056b3;
    }
    .navegacion {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }
    .explicacion {
      margin-top: 10px;
      font-style: italic;
      color: #555;
    }
    .oculto {
      display: none;
    }
    select {
      padding: 10px;
      font-size: 1rem;
    }
  </style>
</head>
<body>
  <div class="contenedor">
    <h1>Banco de Preguntas</h1>

    <div class="modo-selector">
      <label>Modo:
        <select id="modo">
          <option value="test">Modo Test</option>
          <option value="repaso">Modo Repaso</option>
        </select>
      </label>
    </div>

    <div class="filtro">
      <label>Categoría:
        <select id="categoria-filtro">
          <option value="todas">Todas</option>
        </select>
      </label>
    </div>

    <div id="zona-preguntas"></div>

    <div class="navegacion oculto" id="navegacion">
      <button onclick="anteriorPregunta()">Anterior</button>
      <button onclick="siguientePregunta()">Siguiente</button>
    </div>

    <div id="resultado-final" class="oculto"></div>
  </div>

  <script>
    let preguntas = JSON.parse(localStorage.getItem('preguntas')) || [];
    let modo = "test";
    let categoriaSeleccionada = "todas";
    let indice = 0;
    let puntaje = 0;
    let respondidas = [];

    const zona = document.getElementById('zona-preguntas');
    const selectorModo = document.getElementById('modo');
    const selectorCategoria = document.getElementById('categoria-filtro');
    const nav = document.getElementById('navegacion');
    const resultadoFinal = document.getElementById('resultado-final');

    // Inicializar categorías
    function cargarCategorias() {
      const categorias = [...new Set(preguntas.map(p => p.categoria))];
      categorias.forEach(cat => {
        const op = document.createElement('option');
        op.value = cat;
        op.textContent = cat;
        selectorCategoria.appendChild(op);
      });
    }

    // Mostrar preguntas según modo
    function mostrarPreguntas() {
      zona.innerHTML = "";
      resultadoFinal.classList.add("oculto");

      const preguntasFiltradas = preguntas.filter(p =>
        categoriaSeleccionada === "todas" || p.categoria === categoriaSeleccionada
      );

      if (preguntasFiltradas.length === 0) {
        zona.innerHTML = "<p>No hay preguntas en esta categoría.</p>";
        return;
      }

      if (modo === "repaso") {
        nav.classList.add("oculto");
        preguntasFiltradas.forEach((p, i) => zona.appendChild(crearTarjeta(p, i)));
      } else {
        nav.classList.remove("oculto");
        zona.appendChild(crearTarjeta(preguntasFiltradas[indice], indice, preguntasFiltradas));
      }
    }

    function crearTarjeta(pregunta, i, lista = preguntas) {
      const div = document.createElement("div");
      div.className = "pregunta-card";
      div.innerHTML = `<h2>${i + 1}. ${pregunta.pregunta}</h2><div class="opciones"></div><div class="explicacion oculto"></div>`;
      const contOpciones = div.querySelector(".opciones");
      pregunta.opciones.forEach(op => {
        const btn = document.createElement("button");
        btn.textContent = op;
        btn.onclick = () => responder(btn, op, pregunta, div);
        contOpciones.appendChild(btn);
      });
      return div;
    }

    function responder(btn, seleccion, pregunta, tarjeta) {
      const explicacion = tarjeta.querySelector(".explicacion");
      const botones = tarjeta.querySelectorAll("button");

      botones.forEach(b => b.disabled = true);

      if (seleccion === pregunta.respuestaCorrecta) {
        btn.style.backgroundColor = "green";
        if (!respondidas.includes(pregunta)) puntaje++;
      } else {
        btn.style.backgroundColor = "red";
        explicacion.classList.remove("oculto");
        explicacion.textContent = "❌ " + pregunta.explicacion;
      }

      respondidas.push(pregunta);
    }

    function siguientePregunta() {
      const preguntasFiltradas = preguntas.filter(p =>
        categoriaSeleccionada === "todas" || p.categoria === categoriaSeleccionada
      );
      if (indice < preguntasFiltradas.length - 1) {
        indice++;
        mostrarPreguntas();
      } else {
        zona.innerHTML = "";
        nav.classList.add("oculto");
        resultadoFinal.classList.remove("oculto");
        resultadoFinal.innerHTML = `<h2>Resultado final</h2><p>Obtuviste ${puntaje} de ${preguntasFiltradas.length} respuestas correctas.</p>`;
      }
    }

    function anteriorPregunta() {
      if (indice > 0) {
        indice--;
        mostrarPreguntas();
      }
    }

    selectorModo.onchange = () => {
      modo = selectorModo.value;
      indice = 0;
      puntaje = 0;
      respondidas = [];
      mostrarPreguntas();
    };

    selectorCategoria.onchange = () => {
      categoriaSeleccionada = selectorCategoria.value;
      indice = 0;
      puntaje = 0;
      respondidas = [];
      mostrarPreguntas();
    };

    window.onload = () => {
      cargarCategorias();
      mostrarPreguntas();
    };
  </script>
</body>
</html>
